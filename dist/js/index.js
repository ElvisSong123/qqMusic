var timer,root=window.player,audio=root.addAudio,renderObj=root.renderObj,controlIndex=null,deg=0,timeBar=root.timeBar,touchkey=!1;function getData(t){$.ajax({url:t,type:"get",success:function(t){audio.getAudio(t[0].audio),len=t.length,controlIndex=new root.controlIndex(len),bindEvent(t),bindTouch(t[0].duration),renderObj(t,0)},error:function(){}})}function bindEvent(o){var e=0,n=null;$("body").on("play:change",function(t,e){audio.getAudio(o[e].audio),"play"==audio.status?(timeBar.tempt(),audio.play()):(audio.pause(),timeBar.tempt())}),$(".operate .like").on("click",function(){1==o[e].isLike?($(this).removeClass("isLike"),o[e].isLike=!1):($(this).addClass("isLike"),o[e].isLike=!0)}),$(".operate .prev").on("click",function(){deg=0,e=controlIndex.prev(n),n=null,bindTouch(o[e].duration),$("body").trigger("play:change",e),timeBar.timeBarRun(o[e].duration,0),"pause"==audio.status&&timeBar.tempt(),renderObj(o,e)}),$(".operate .next").on("click",function(){deg=0,e=controlIndex.next(n),n=null,bindTouch(o[e].duration),$("body").trigger("play:change",e),timeBar.timeBarRun(o[e].duration,0),"pause"==audio.status&&timeBar.tempt(),renderObj(o,e)}),$(".operate .suspend").on("click",function(t){"pause"==audio.status?(timeBar.timeBarRun(o[e].duration),audio.play(),$(this)[0].style.backgroundImage="url(../image/icon-pause.png)",rotate()):(audio.pause(),timeBar.tempt(),$(this)[0].style.backgroundImage="url(../image/icon-play.png)",clearInterval(timer))}),$(".operate .list").on("click",function(t){t.stopPropagation(),$(".song-list").show()}),$(".wrapper").on("click",function(){$(".song-list").hide()}),$(".song-list").on("click",function(t){clearInterval(timer),t.stopPropagation();var e=t.target,a=$(e).attr("data-index");renderObj(o,a),$(".song-list").hide(),n=a,$("body").trigger("play:change",a),timeBar.timeBarRun(o[a].duration,0),audio.play(),$(".operate .suspend")[0].style.backgroundImage="url(../image/icon-pause.png)",rotate()})}function bindTouch(n){var i;$(".spot").on("touchstart",function(t){}).on("touchmove",function(t){touchkey=!0,"play"==audio.status&&(audio.pause(),timeBar.tempt(),$(".operate .suspend")[0].style.backgroundImage="url(../image/icon-play.png)");var e=t.touches[0].clientX,a=$(".timeBar_bottom").offset().left,o=$(".timeBar_bottom").width()-12;(i=(e-a)/o)<0&&(i=0),.97<i&&(i=.97),timeBar.update(100*i,n)}).on("touchend",function(t){clearInterval(timer),timeBar.tempt(),audio.playTo(i*n),audio.play(),$(".operate .suspend")[0].style.backgroundImage="url(../image/icon-pause.png)",timeBar.timeBarRun(n,i*n*1e3),rotate()})}function rotate(){timer=setInterval(function(){deg+=.3,$(".img img")[0].style.transform="rotate("+deg+"deg)"},50)}getData("../mock/data.json");